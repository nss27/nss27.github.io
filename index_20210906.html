<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JS 연동 페이지</title>
    <style>
    	html, body { height:100%; margin:0; }
    	section { padding:10px; }
    	button { margin-bottom: 5px; }
    </style>
</head>
<body>
	<div class="container">
		<section>
			<div id="checkMobile">Mobile 여부 : </div>
		</section>

		<section>

			--------------- common --------------<br/>
			<a href="javascript:setStorageKey('isFirstRun')">isFirstRun:최초실행여부</a>
			<br />

			<input id="selectKey" type="text" placeholder="데이터 키값"/>
			<button id="btnSelectStorage">디바이 정보 조회</button><br/>

			<input id="saveData" type="text" placeholder="저장할 문자열" />
			<button id="btnInsertStorage">디바이스 정보 등록</button>
		</section>

		<section>
			----------------- fido -----------------<br/>
			<input id="fidoUserId" type="text" placeholder="pnsrNpsNo" /><br />
			<button id="btnFidoRegist">FIDO 사용자 등록</button>
			<button id="btnFidoAuth">FIDO 사용자 인증</button>
		</section>

		<section>
			----------------- bio ------------------<br/>
			<div>!! 카메라 권한 체크는 등록에만 걸어놨습니다. 등록 후 인증을 해주세요.</div>
			<button id="btnRegistBio">여권(안면+음성) 본인등록</button><br />
			<button id="btnConfirmBio">생체정보 인증 </button><br />
			<button id="btnRemoveBio">안면정보 제거</button>
		</section>

		<section>
			----------------- ocr ------------------<br/>
			<button id="btnRegistPassport">여권 촬영</button>
		</section>

		<section>
			----------------- didBridge ------------------<br/>
			<button id="btnCreateDID">DID 도큐먼트 생성</button>
			<button id="btnIssueVC">VC 발급</button>
			<button id="btnRequestVP">VP 요청</button>
		</section>

		<section>
			----------------- 암복호화 저장 테스트 ------------------<br/>
			<button id="btnEncryptStore">암호화 저장</button>
			<button id="btnDecryptStrore">복호화 로드</button>
		</section>

		<div>
			github page 호출중
		</div>
	</div>
</body>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script>
if (!window.didBridge) {
	alert('DID용 함수 연결 실패!');
}

$(function() {
	$("#checkMobile").append(isMobile().toString());

	if (!isMobile()) {
		return;
	}

	//디바이스 데이터 조회
	$('#btnSelectStorage').click(function() {
		$('#selectKey').val().length > 0
		&& webViewBridge.getLocalStorage($("#selectKey").val(), "callback");
	})

	//디바이스 데이터 저장
	$('#btnInsertStorage').click(function() {
		$('#selectKey').val().length > 0 && $('#saveData').val().length > 0
		&& webViewBridge.setLocalStorage($("#selectKey").val(), $("#saveData").val(), "callback");
	})

	/********************* FIDO *********************/

	//fido 사용자 등록 호출
	$('#btnFidoRegist').click(function() {
		$('#fidoUserId').val().length > 0 
		&& fidoBridge.callSimpleCert($('#fidoUserId').val(), "deedNo", "excvYq", "N", "callback");
	})

	//fido 사용자 인증
	$('#btnFidoAuth').click(function() {
		$('#fidoUserId').val().length > 0 
		&& fidoBridge.callSimpleCert($('#fidoUserId').val(), "deedNo", "excvYq", "Y", "callback");
	})


	/********************* BIO *********************/
	//생체정보 본인등록(안면+음성 등록)
	$('#btnRegistBio').click(function() {
		bioBridge.callRegistBio("pnsrNpsNo", "deedNo", "excvYq");
	})

	//생체정보 인증(안면+음성 검증)
	$('#btnConfirmBio').click(function() {
		bioBridge.callConfirmBio("pnsrNpsNo", "deedNo", "excvYq");
	})

	$('#btnRemoveBio').click(function() {
		bioBridge.callRemoveBio();
	})

	/********************* OCR *********************/
	//여권촬영
	$('#btnRegistPassport').click(function() {
		ocrBridge.callRegistPassport("test");
	})

	// ==================== DID ==============
	$('#btnCreateDID').click(function() {
		didBridge.createDid();
	});

	$('#btnIssueVC').click(function() {
		didBridge.issueDidVC();
	});

	$('#btnRequestVP').click(function() {
		didBridge.requestDidVP();
	});

	// ==================== 암복호화 테스트 ==============
	$('#btnEncryptStore').click(function() {
		didBridge.encrypt("key1", "암호화 저장 테스트 입니다. 한글도 잘 되겠지요?");
	});
	$('#btnDecryptStrore').click(function() {
		didBridge.decrypt("key1");
	});
});

/**
 * 모바일 기기체크
 **/
const isMobile = () => {
	return navigator.userAgent.indexOf('npsMobile') > -1;
}

/**
 * 인터페이스 콜백함수(테스트용)
 **/
const callback = (data) => {
	let resultData = data;

	if(typeof data === 'object') resultData = JSON.stringify(resultData);

	alert(resultData);
}

const setStorageKey = (key) => {
	$('#selectKey').val(key);
}

const responseVP = (vp) => {
	console.log('vp: ' + vp);
};
</script>
</html>
